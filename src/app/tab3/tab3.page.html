<ion-content fullscreen="true">
  <h1>Réservation(s) en cours</h1>

  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content
      pullingIcon="chevron-down-circle-outline"
      refreshingSpinner="circles"
    >
    </ion-refresher-content>
  </ion-refresher>

  <ion-card *ngFor="let res of reservationData" class="custom-card">
    <ion-item>
      <ion-button fill="clear" slot="end" class="message-icon" (click)="navigateToTab2()">
        <ion-icon name="chatbubbles-outline"></ion-icon>
      </ion-button>
    </ion-item>
    <ion-card-header>
      <img [src]="res.Photos" alt="Image de l'emplacement">
      <h2>{{ res.address }}</h2>
    </ion-card-header>
    <ion-card-content>

      <p *ngIf="res.isDone" class="reservation-done"><strong>Réservation terminée</strong></p>
      <br>

   
      <p><strong>Prix/heure:</strong> {{ res.price }} EUR</p>
      <p><strong>Date de réservation:</strong> {{ res.reservationDate.toDate() | date:'mediumDate' }}</p>
      

      <p><strong>Début de réservation:</strong> {{ res.departureTime }}</p>
      <p><strong>Fin de réservation:</strong> {{ res.endTime }}</p>
      <p><strong>De</strong> {{ res.departureTime }} à {{ res.endTime }}</p>
     <p><strong>Prix total:</strong> {{ calculateTotalPrice(res.reservationDate.toDate() | date:'yyyy-MM-dd', res.departureTime, res.endTime, res.price) }} EUR</p>
      <p><strong>Durée de la réservation:</strong> {{ calculateDuration(res.departureTime, res.endTime) }}</p>
      
      <ng-container *ngIf="!res.isPayed && res.countdown !== 'temps écoulé'">
        <ion-select placeholder="Sélectionnez un véhicule" [(ngModel)]="selectedCar" (ionChange)="onCarChange($event)">
          <ion-select-option *ngFor="let vehicle of vehicles" [value]="vehicle">
            {{ vehicle.marque }} - {{ vehicle.plaque }}
          </ion-select-option>
        </ion-select>
        
        

        <ion-button (click)="confirmReservation(res)" class="custom-button">Confirmer la réservation</ion-button>
      </ng-container>
      <p *ngIf="!res.isPayed" class="countdown"><strong>Temps restant:</strong> {{ res.countdown }}</p>
        <p *ngIf="res.isPayed" class="reserved"><strong>Réservé!</strong></p>
        <ion-button *ngIf="res.isPayed && !res.isCancelled && !res.isDone" (click)="cancelReservation(res)" class="cancel-button">
          Terminer la réservation
        </ion-button>
  
    </ion-card-content>
  </ion-card>
</ion-content>

